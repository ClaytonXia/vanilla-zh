##如何从vanilla-0.1.0.rc4到vanilla-0.1.0.rc5

### *升级步骤*

#### 1.安装最新的 vanilla-0.1.0.rc5

``` bash
$ wget https://github.com/idevz/vanilla/archive/v0.1.0-rc5.0.tar.gz
$ tar zxf v0.1.0-rc5.0.tar.gz
$ cd vanilla-0.1.0.rc5
$ ./setup-framework -v $VANILLA_PROJ_ROOT -o $OPENRESTY_ROOT  #$VANILLA_PROJ_ROOT 为给 Vanilla 指定的安装目录， $OPENRESTY_ROOT 是当前 OpenResty 的安装目录
```

#### 2.基于新的 Vanilla（vanilla-0.1.0.rc5） 初始化新版的 vatest 项目：

``` bash
$ sudo vanilla-0.1.0.rc5 new $VANILLA_APP_ROOT      #$VANILLA_APP_ROOT 为新版 vatest 项目全路径
```

#### 3.将新项目中的以下目录及文件直接覆盖至老版 vatest 的相关位置：
- pub/index.lua 文件（$VANILLA_APP_ROOT/pub/index.lua）直接覆盖
- va-vasina-service 脚本（$VANILLA_APP_ROOT/va-vasina-service）直接复制，因为老版没有这个文件
    - 注意确认脚本中 $OPENRESTY_NGINX_ROOT 的路径
    - 注意确认脚本中 $VA_APP_PATH 的路径是否为项目的根路径
- nginx_conf 目录（$VANILLA_APP_ROOT/nginx_conf）直接复制，因为老版没有这个目录
- application/bootstrap.lua 文件（$VANILLA_APP_ROOT/application/bootstrap.lua）将老项目 bootstrap 中的相关 init* 方法拷贝到新的 bootstrap.lua 中，并用新的 bootstrap.lua 覆盖老版的 bootstrap.lua 文件
- 修改 $VANILLA_APP_ROOT/nginx_conf 中的 nginx 配置文件， 确保其中各种目录正确
    - 确保 $VANILLA_APP_ROOT/nginx_conf/va-nginx{-development}.conf 文件中 lua_package_{c}path 中， 全路径的 Vanilla 框架目录正确
    - 确保 $VANILLA_APP_ROOT/nginx_conf/{dev_}vhost/vasina.conf 文件中 Server 段的 `root` 配置为项目根目录， `require` 方法中 `local VANILLA_ROOT` 为框架根路径


#### 4.使用 $VANILLA_APP_ROOT/va-vasina-service 脚本管理服务：
1. 给 $VANILLA_APP_ROOT/va-vasina-service 脚本添加可执行权限 `chmod +x $VANILLA_APP_ROOT/va-vasina-service`
2. 初始化 nginx 配置 `$VANILLA_APP_ROOT/va-vasina-service initconf [dev]`
3. 启动服务 `$VANILLA_APP_ROOT/va-vasina-service start [dev]`

注： 添加 `dev` 参数，则管理 development 环境的服务， 默认为 production 生产环境服务

### 社区组织
#### *QQ群&&微信公众号*
- *Openresty/Vanilla 开发 1 群：205773855*
- *Openresty/Vanilla 开发 2 群：419191655*
- *Openresty 技术交流 1 群：34782325*
- *Openresty 技术交流 2 群：481213820*
- *Openresty 技术交流 3 群：124613000*
- *Vanilla开发微信公众号:Vanilla-OpenResty(Vanilla相关资讯、文档推送)*

![vanilla](va_c.jpeg)

[![QQ](http://pub.idqqimg.com/wpa/images/group.png)](http://shang.qq.com/wpa/qunwpa?idkey=673157ee0f0207ce2fb305d15999225c5aa967e88913dfd651a8cf59e18fd459)